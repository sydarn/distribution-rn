#!/bin/sh
# SPDX-License-Identifier: GPL-2.0
# Copyright (C) 2024 ROCKNIX (https://github.com/ROCKNIX)
. /etc/profile.d/001-functions

# Mount /flash/ modify extlinux.conf to set correct dtbo overlay

mount -o remount,rw /flash

# Delete all previous overlays
sed -i "/FDTOVERLAYS/d" /flash/extlinux/extlinux.conf

case ${1} in
   "panfrost")
     sed -i "/FDT/a \ \ FDTOVERLAYS /overlays/panthor.dtbo" /flash/extlinux/extlinux.conf
   ;;
esac

mount -o remount,ro /flash
